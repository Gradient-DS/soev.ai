global:
  # Default resolve timeout for alerts
  resolve_timeout: 5m

# The directory from which notification templates are read.
templates:
- '/etc/alertmanager/templates/*.tmpl'

# The root route on which each alert enters.
route:
  # The labels by which incoming alerts are grouped together.
  group_by: ['alertname', 'cluster', 'service', 'instance']

  # When a new group of alerts is created, wait at least 'group_wait'
  # to send the initial notification.
  group_wait: 10s

  # When the first notification was sent, wait 'group_interval' to send a batch
  # of new alerts that started firing for that group.
  group_interval: 10s

  # If an alert has successfully been sent, wait 'repeat_interval' to resend.
  repeat_interval: 1h

  # A default receiver
  receiver: 'slack-notifications'

  # Routes allow you to route alerts to different receivers based on labels
  routes:
  - match:
      severity: critical
    receiver: 'slack-critical'
    continue: true
  - match:
      severity: warning
    receiver: 'slack-warnings'
    continue: true

# Inhibition rules allow to mute a set of alerts given that another alert is firing.
inhibit_rules:
- source_matchers:
    - severity = "critical"
  target_matchers:
    - severity = "warning"
  # Apply inhibition if the alertname is the same.
  equal: ['alertname', 'cluster', 'service']

receivers:
- name: 'slack-notifications'
  slack_configs:
  - api_url_file: /tmp/slack_webhook
    channel: '#monitoring'
    title: '{{ if eq .Status "resolved" }}‚úÖ RESOLVED - {{ .CommonLabels.alertname }}{{ else }}‚ö†Ô∏è ALERT - {{ .CommonLabels.alertname }}{{ end }}'
    text: |
      {{- $svc := or .CommonLabels.service .CommonLabels.job -}}
      {{- $inst := .CommonLabels.instance -}}
      {{- if eq .Status "resolved" }}Resolved{{ else }}Firing{{ end }}: {{$svc}} {{$inst}}
      {{- if .CommonAnnotations.summary }}
      Summary: {{ .CommonAnnotations.summary }}
      {{- end }}
      {{- if .CommonAnnotations.description }}
      Description: {{ .CommonAnnotations.description }}
      {{- end }}
      Links: <http://localhost/grafana/d/soevai-monitoring/soevai-monitoring|Grafana> ¬∑ <http://localhost/prometheus/alerts|Prometheus> ¬∑ <http://localhost/alertmanager/|Alertmanager>
    send_resolved: true

- name: 'slack-critical'
  slack_configs:
  - api_url_file: /tmp/slack_webhook
    channel: '#monitoring'
    title: '{{ if eq .Status "resolved" }}‚úÖ RESOLVED - {{ .CommonLabels.alertname }}{{ else }}üö® CRITICAL - {{ .CommonLabels.alertname }}{{ end }}'
    text: |
      {{- $svc := or .CommonLabels.service .CommonLabels.job -}}
      {{- $inst := .CommonLabels.instance -}}
      {{- if eq .Status "resolved" }}Resolved{{ else }}Firing{{ end }}: {{$svc}} {{$inst}}
      {{- if .CommonAnnotations.description }}
      {{ .CommonAnnotations.description }}
      {{- end }}
      Links: <http://localhost/grafana/d/soevai-monitoring/soevai-monitoring|Grafana> ¬∑ <http://localhost/prometheus/alerts|Prometheus> ¬∑ <http://localhost/alertmanager/|Alertmanager>
    send_resolved: true
    color: 'danger'

- name: 'slack-warnings'
  slack_configs:
  - api_url_file: /tmp/slack_webhook
    channel: '#monitoring'
    title: '{{ if eq .Status "resolved" }}‚úÖ RESOLVED - {{ .CommonLabels.alertname }}{{ else }}‚ö†Ô∏è WARNING - {{ .CommonLabels.alertname }}{{ end }}'
    text: |
      {{- $svc := or .CommonLabels.service .CommonLabels.job -}}
      {{- $inst := .CommonLabels.instance -}}
      {{- if eq .Status "resolved" }}Resolved{{ else }}Firing{{ end }}: {{$svc}} {{$inst}}
      {{- if .CommonAnnotations.summary }}
      Summary: {{ .CommonAnnotations.summary }}
      {{- end }}
      Links: <http://localhost/grafana/d/soevai-monitoring/soevai-monitoring|Grafana> ¬∑ <http://localhost/prometheus/alerts|Prometheus>
    send_resolved: true
    color: 'warning'

